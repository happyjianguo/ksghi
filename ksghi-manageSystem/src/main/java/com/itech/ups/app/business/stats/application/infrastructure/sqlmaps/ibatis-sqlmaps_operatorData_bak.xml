<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="operatorData_bak">
    <!-- 互联网金融信息披露 -->
    <sql id="financialDisclosure_fragment">
	with taball as
	 (select ta."指标编码" "indexCode",
	         ta."指标名称" "indexName",
	         round(ta."填报内容", 2) "content",
	         ta."填报说明" "desc"
	    from ((select 'H41001' "指标编码",
	                  '交易总额(万元)' "指标名称",
	                  sum(t.amount) / 10000 "填报内容",
	                  '指自平台上线运营时起，成功的融资项目的本金总额' "填报说明"
	             from PRODUCT t
	            where t.data_status = 'valid'
	              and t.status not in ('init', 'fail')
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41002' "指标编码",
	                  '交易总笔数(笔)' "指标名称",
	                  count(*) "填报内容",
	                  '指自平台上线运营时起，成功的融资项目总笔数' "填报说明"
	             from PRODUCT t
	            where t.data_status = 'valid'
	              and t.status not in ('init', 'fail')
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41003' "指标编码",
	                  '出借总笔数(笔)' "指标名称",
	                  count(distinct t.tender_id) "填报内容",
	                  '指自平台上线运营时起，平台实际撮合成功的所有出借总笔数' "填报说明"
	             from tender_loan t
	            where t.resp_status = 'success'
	              and t.data_status = 'valid'
	              and t.create_time <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41004' "指标编码",
	                  '融资人总数(人)' "指标名称",
	                  count(distinct t.borrower_user_info_id) "填报内容",
	                  '指自平台上线运营时起，平台实际撮合成功的融资项目中融资人总数(人数不是人次)，注意去重' "填报说明"
	             from PRODUCT t
	            where t.data_status = 'valid'
	              and t.status not in ('init', 'fail')
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41005' "指标编码",
	                  '出借人总数(人)' "指标名称",
	                  count(distinct t.user_info_id) "填报内容",
	                  '指自平台上线运营时起，平台实际撮合成功的融资项目中出借人总数(人数不是人次)，注意去重' "填报说明"
	             from tender_loan t
	            where t.resp_status = 'success'
	              and t.data_status = 'valid'
	              and t.create_time <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41006' "指标编码",
	                  '待偿金额(万元)' "指标名称",
	                  nvl(sum(t.repay_principal_amount) / 10000,0) "填报内容",
	                  '指截至统计时点，平台所有融资人尚未偿还的本金总金额(不包括利息部分)' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	              and t.data_status = 'valid'
	              and t.status = 'unRepay') union
	          (select 'H41007' "指标编码",
	                  '逾期金额(万元)' "指标名称",
	                  nvl(sum(t.repay_principal_amount) / 10000, 0) "填报内容",
	                  '指截至统计时点，所有逾期的且尚未偿还的本金金额总和' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.data_status = 'valid'
	              and t.user_info_id != '14082511240267427903'
	              and to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd')-to_date(t.repay_plan_date, 'yyyy-mm-dd')>5
	              and t.status = 'unRepay') union
	          (select 'H41008' "指标编码",
	                  '项目逾期率(%)' "指标名称",
	                  count(distinct
	                        decode(sign(to_date(t.repay_plan_date, 'yyyy-mm-dd') -
	                                    to_date(#monthEndDate#, 'yyyy-mm-dd')+5),
	                               -1,
	                               t.product_id,
	                               null)) * 100 / count(distinct t.product_id) "填报内容",
	                  '指截至统计时点，所有逾期且尚未偿还的融资项目数与尚未偿还的融资项目总数之比' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.data_status = 'valid'
	              and t.user_info_id != '14082511240267427903'
	              and t.status = 'unRepay') union
	          (select 'H41009' "指标编码",
	                  '金额逾期率(%)' "指标名称",
	                  sum(decode(sign(to_date(t.repay_plan_date, 'yyyy-mm-dd') -
	                                  to_date(#monthEndDate#, 'yyyy-mm-dd')+5),
	                             -1,
	                             t.repay_principal_amount,
	                             0)) * 100 / sum(t.repay_principal_amount) "填报内容",
	                  '指截至统计时点，所有逾期且尚未偿还的本金金额与未偿还的本金金额总和之比' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.data_status = 'valid'
	              and t.user_info_id != '14082511240267427903'
	              and t.status = 'unRepay') union
	          (select 'H41010' "指标编码",
	                  '逾期项目数(个)' "指标名称",
	                  count(distinct
	                        decode(sign(to_date(t.repay_plan_date, 'yyyy-mm-dd') -
	                                    to_date(#monthEndDate#, 'yyyy-mm-dd')+5),
	                               -1,
	                               t.product_id,
	                               null)) "填报内容",
	                  '所有逾期且尚未偿还的项目总数' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.data_status = 'valid'
	              and t.user_info_id != '14082511240267427903'
	              and t.status = 'unRepay') union
	          (select 'H41011' "指标编码",
	                  '人均累积融资金额(万元)' "指标名称",
	                  nvl(sum(t.repay_principal_amount) / 10000 /
	                  count(distinct t.borrower_user_info_id),0) "填报内容",
	                  '指自平台上线运营之日起，交易总额与融资人总数之比(分母是人数不是人次)' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	              and t.data_status = 'valid'
	              and t.status not in ('cancel', 'fail')) union
	          (select 'H41012' "指标编码",
	                  '人均累积出借金额(万元)' "指标名称",
	                  nvl(sum(t.repay_principal_amount) /
	                  count(distinct t.user_info_id) / 10000,0) "填报内容",
	                  '指自平台上线运营之日起，交易总额与出借人总数之比(分母是人数不是人次)' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	              and t.data_status = 'valid'
	              and t.status not in ('cancel', 'fail')) union
	          (select 'H41013' "指标编码",
	                  '笔均融资金额(万元)' "指标名称",
	                  avg(t.amount) / 10000 "填报内容",
	                  '指自平台上线运营之日起，交易总额与交易总笔数之比' "填报说明"
	             from PRODUCT t
	            where t.status not in ('init', 'fail')
	              and t.data_status = 'valid'
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#) union
	          (select 'H41014' "指标编码",
	                  '最大单户融资余额占比(%)' "指标名称",
	                   round(sum(case
                   when rownum <![CDATA[<=]]> 1 then
                    最大单户借款余额
                   else
                    0
                 end) * 100 / sum(最大单户借款余额),
             2) "填报内容",
	                  '指截至统计时点，待偿金额最大的融资人的待偿金额与平台总待偿金额之比' "填报说明" from (
	                   select t.borrower_user_info_id,
	                          nvl(sum(t.repay_amount + t.fee) ,0) 最大单户借款余额
	                     from TENDER_REPAYMENT t
	                    where ((t.repay_plan_date > #monthEndDate# and
               t.status not in ('cancel', 'fail')) or t.status = 'unRepay')
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id
	                    order by sum(t.repay_amount + t.fee) desc
	           )) 
	  union (select 'H41015' "指标编码",
	               '最大10户融资余额占比(%)' "指标名称",
	               round(sum(case
                   when rownum <![CDATA[<=]]> 10 then
                    最大十户借款余额
                   else
                    0
                 end) * 100 / sum(最大十户借款余额),
             2) "填报内容",
	               '指截至统计时点，待偿金额最大的前十名融资人的待偿金额总和与平台总待偿金额之比' "填报说明" from (
	                select t.borrower_user_info_id,
	                       sum(t.repay_amount + t.fee) 最大十户借款余额
	                  from TENDER_REPAYMENT t
	                 where ((t.repay_plan_date > #monthEndDate# and
               t.status not in ('cancel', 'fail')) or t.status = 'unRepay')
	                   and t.data_status = 'valid'
	                 group by t.borrower_user_info_id
	                 order by sum(t.repay_amount + t.fee) desc)
	        ) union
	 (select 'H41016' "指标编码",
	         '最大单户出借余额占比(%)' "指标名称",
	          round(sum(case
                   when rownum <![CDATA[<=]]> 1 then
                    最大单户出借余额
                   else
                    0
                 end) * 100 / sum(最大单户出借余额),
             2) "填报内容",
	         '出借金额最大的出借人的出借金额总和与平台总出借金额之比' "填报说明" from (
	          select t.user_info_id,
	                 sum(t.trans_amount) 最大单户出借余额
	            from TENDER t
	           where t.status not in ('fail', 'cancel')
	             and t.data_status = 'valid'
	             and t.create_time <![CDATA[<=]]> #monthEndDate#
	           group by t.user_info_id
	           order by sum(t.trans_amount) desc)
	  )  union
	 (select 'H41017' "指标编码",
	         '最大10户出借余额占比(%)' "指标名称",
	         round(sum(case
                   when rownum <![CDATA[<=]]> 10 then
                    最大10户出借余额
                   else
                    0
                 end) * 100 / sum(最大10户出借余额),
             2) "填报内容",
	         '截至统计时点，出借金额最大的前十名出借人的出借金额总和与平台总出借金额之比和' "填报说明" from (
	          select t.user_info_id,
	                 sum(t.trans_amount)  最大10户出借余额
	            from TENDER t
	           where t.status not in ('fail', 'cancel')
	             and t.data_status = 'valid'
	             and t.create_time <![CDATA[<=]]> #monthEndDate#
	           group by t.user_info_id
	           order by sum(t.trans_amount) desc)
	  )  union
	 (select 'H41018' "指标编码",
	         '项目分级逾期率(90天)(%)' "指标名称",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 1 and 90 then
	                  t.product_id
	                 else
	                  null
	               end) * 100 / count(distinct t.product_id) "填报内容",
	         '截至统计时点，逾期90天(含)，披露项目逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41019' "指标编码",
	         '项目分级逾期率(91-180天)(%)' "指标名称",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 92 and 180 then
	                  t.product_id
	                 else
	                  null
	               end) * 100 / count(distinct t.product_id) "填报内容",
	         '截至统计时点，逾期90-180天(含)，披露项目逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41020' "指标编码",
	         '项目分级逾期率(181天以上)(%)' "指标名称",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 182 and 999 then
	                  t.product_id
	                 else
	                  null
	               end) * 100 / count(distinct t.product_id) "填报内容",
	         '截至统计时点，逾期180天以上，披露项目逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41021' "指标编码",
	         '金额分级逾期率(90天)(%)' "指标名称",
	         sum(CASE
	               WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                    to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 1 and 90 then
	                t.repay_principal_amount
	               else
	                0
	             end) * 100 / sum(t.repay_principal_amount) "填报内容",
	         '截至统计时点，逾期90天(含)，披露金额逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41022' "指标编码",
	         '金额分级逾期率(91-180天)(%)' "指标名称",
	         sum(CASE
	               WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                    to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 92 and 180 then
	                t.repay_principal_amount
	               else
	                0
	             end) * 100 / sum(t.repay_principal_amount) "填报内容",
	         '截至统计时点，逾期90-180天(含)，披露金额逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41023' "指标编码",
	         '金额分级逾期率(181天以上)(%)' "指标名称",
	         sum(CASE
	               WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                    to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 182 and 999 then
	                t.repay_principal_amount
	               else
	                0
	             end) * 100 / sum(t.repay_principal_amount) "填报内容",
	         '截至统计时点，逾期180天以上，披露金额逾期率' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union
	 (select 'H41024' "指标编码",
	         '历史项目逾期金额(万元)' "指标名称",
	         nvl(sum(t.repay_principal_amount) / 10000,0) "填报内容",
	         '截至统计时点，历史以来累计发生逾期的项目本金' "填报说明"
	    from TENDER_REPAYMENT t, product p
	   where t.product_id = p.id
	     and t.user_info_id != '14082511240267427903'
	     and ((to_date(t.repay_plan_date, 'yyyy-mm-dd')+5 -
           to_date(substr(t.repay_time, 1, 10), 'yyyy-mm-dd')<![CDATA[<]]>0) or
	         (t.status = 'unRepay' and (NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]> to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd'))))
	     and t.data_status = 'valid'
	     and p.data_status = 'valid'
	     and p.name not like '%惠金绩优%'
	     and p.status not in ('init', 'fail')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#) union
	 (select 'H41025' "指标编码",
	         '历史项目逾期率(%)' "指标名称",
	         sum(case
	               when ((to_date(t.repay_plan_date, 'yyyy-mm-dd')+5 -
           to_date(substr(t.repay_time, 1, 10), 'yyyy-mm-dd')<![CDATA[<]]>0) or
	                    (t.status = 'unRepay' and ((to_date(t.repay_plan_date, 'yyyy-mm-dd')+5)-to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd') <![CDATA[<]]>0 ))) and
	                    p.name not like '%惠金绩优%' then
	                t.repay_principal_amount
	               else
	                0
	             end) * 100 / sum(case
	                                when p.status not in ('init', 'fail') and
	                                     p.repay_start_date <![CDATA[<=]]> #monthEndDate# and
	                                     p.data_status = 'valid' then
	                                 t.repay_principal_amount
	                                else
	                                 0
	                              end) "填报内容",
	         '截至统计时点，历史项目逾期金额与历史项目累计交易总额之比' "填报说明"
	    from TENDER_REPAYMENT t, product p
	   where t.product_id = p.id
	     and t.user_info_id != '14082511240267427903'
	     and t.data_status = 'valid'
	     and p.data_status = 'valid'
	     and t.status != 'cancel'
	     and t.repay_principal_amount > 0
	     and p.status not in ('init', 'fail')) union
	 (select 'H41026' "指标编码",
	         '累计逾期代偿金额(万元)' "指标名称",
	         nvl(sum(t.repay_amount + t.fee) / 10000,0) "填报内容",
	         '截至统计时点，由非第一还款来源代偿的金额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.borrower_user_info_id != t.repay_user_id
	     and t.data_status = 'valid'
	     and t.status not in ('cancel', 'fail')
	     and NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]>
	         to_date(substr(t.repay_time, 1, 10), 'yyyy-mm-dd')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#) union
	 (select 'H41027' "指标编码",
	         '累计逾期代偿笔数(笔)' "指标名称",
	         count(t.tender_id) "填报内容",
	         '截至统计时点，由非第一还款来源代偿的总笔数' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.borrower_user_info_id != t.repay_user_id
	     and t.data_status = 'valid'
	     and t.status not in ('cancel', 'fail')
	     and NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]>
	         to_date(substr(t.repay_time, 1, 10), 'yyyy-mm-dd')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#)) ta)
	
	select taball."indexCode",
	       taball."indexName",
	       taball."content",
	       taball."desc"
	  from taball
  </sql>

    <select id="selectFinancialDisclosure" resultClass="hashMap" parameterClass="map">
        select * from ( select rowtemp.*, rownum rownumtemp from (
        <include refid="financialDisclosure_fragment"/>
        ) rowtemp )
        where rownumtemp <![CDATA[<=]]> #rowEnd#
        and rownumtemp  <![CDATA[>]]> #rowStart#
    </select>

    <select id="selectFinancialDisclosureTotalCount" resultClass="int" parameterClass="map">
        select count (*) as total from (
        <include refid="financialDisclosure_fragment"/>
        )
    </select>


    <!-- 企业数据报送-->
    <sql id="enterpriseDataSubmit_fragment">
	with taball as
	 (select ta."指标编码" "indexCode",
	         ta."指标名称" "indexName",
	         ta."频度" "frequency",
	         round(ta."金额(数量)", 2) "amount",
	         ta."填报说明" "desc"
	    from ((select 'H5033' "指标编码",
	                  '当期个体直接借贷借款金额(万元)' "指标名称",
	                  '月度' "频度",
	                  nvl(sum(t.amount), 0) / 10000 "金额(数量)",
	                  '指借款人通过个体直接借贷成功借款的金额' "填报说明"
	             from PRODUCT t
	            where t.repay_start_date <![CDATA[>=]]> #monthStartDate#
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	              and t.data_status = 'valid') union all
	          (select 'H5034' "指标编码",
	                  '当期个体直接借贷借款笔数(笔)' "指标名称",
	                  '月度' "频度",
	                  count(*) "金额(数量)",
	                  '指借款人通过个体直接借贷成功借款的借款笔数' "填报说明"
	             from PRODUCT t
	            where t.repay_start_date <![CDATA[>=]]> #monthStartDate#
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	              and t.data_status = 'valid') union all
	          (select 'H5035' "指标编码",
	                  '当期个体直接借贷出借人数量(人)' "指标名称",
	                  '月度' "频度",
	                  count(distinct t.user_info_id) "金额(数量)",
	                  '指通过个体直接借贷成功出借资金出借人数量' "填报说明"
	             from tender_loan t
	            where t.create_time <![CDATA[>=]]> #monthStartDate#
	              and t.create_time <![CDATA[<=]]> #monthEndDate#
	              and t.resp_status = 'success'
	              and t.data_status = 'valid') union all
	          (select 'H5036' "指标编码",
	                  '当期个体直接借贷发生额的加权平均利率(%)' "指标名称",
	                  '月度' "频度",
	                  nvl(avg(a.rate), 0) "金额(数量)",
	                  '指用当期个体直接借贷业务发生金额为权重加权计算的平均利率' "填报说明"
	             from (select t.borrower_user_info_id,
	                          (t.annual_rate * t.amount / sum(t.amount)) rate
	                     from PRODUCT t
	                    where t.repay_start_date <![CDATA[>=]]> #monthStartDate#
	                      and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id, t.annual_rate * t.amount) a)
	          union all
	          (select 'H5037' "指标编码",
	                  '当期个体直接借贷发生额的加权平均期限(月)' "指标名称",
	                  '月度' "频度",
	                  nvl(avg(a.time_limit), 0) "金额(数量)",
	                  '指用当期个体直接借贷业务发生金额为权重加权计算的平均借款期限' "填报说明"
	             from (select t.borrower_user_info_id,
	                          (t.time_limit * t.amount / sum(t.amount)) time_limit
	                     from PRODUCT t
	                    where t.repay_start_date <![CDATA[>=]]> #monthStartDate#
	                      and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id, t.time_limit * t.amount) a)
	          union all (select 'H5038' "指标编码",
	                        '当年个体直接借贷累计借款金额(万元)' "指标名称",
	                        '月度' "频度",
	                        nvl(sum(t.amount), 0) / 10000 "金额(数量)",
	                        '指当年个体直接借贷累计借款金额' "填报说明"
	                   from PRODUCT t
	                  where t.repay_start_date <![CDATA[>=]]> #yearStartDate#
	                    and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                    and t.data_status = 'valid') union all
	          (select 'H5039' "指标编码",
	                  '当年个体直接借贷累计借款笔数(笔)' "指标名称",
	                  '月度' "频度",
	                  count(*) "金额(数量)",
	                  '指当年个体直接借贷累计借款笔数' "填报说明"
	             from PRODUCT t
	            where t.repay_start_date <![CDATA[>=]]> #yearStartDate#
	              and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	              and t.status not in ('init', 'fail')
	              and t.data_status = 'valid') union all
	          (select 'H5040' "指标编码",
	                  '当年个体直接借贷出借人数量(人)' "指标名称",
	                  '月度' "频度",
	                  count(distinct t.user_info_id) "金额(数量)",
	                  '指当年个体直接借贷出借人数量' "填报说明"
	             from tender_loan t
	            where t.create_time <![CDATA[>=]]> #yearStartDate#
	              and t.create_time <![CDATA[<=]]> #monthEndDate#
	              and t.resp_status = 'success'
	              and t.data_status = 'valid') union all
	          (select 'H5041' "指标编码",
	                  '当年个体直接借贷发生额的加权平均利率(%)' "指标名称",
	                  '月度' "频度",
	                  nvl(avg(a.rate), 0) "金额(数量)",
	                  '指用当年个体直接借贷业务发生金额为权重加权计算的平均利率' "填报说明"
	             from (select t.borrower_user_info_id,
	                          (t.annual_rate * t.amount / sum(t.amount)) rate
	                     from PRODUCT t
	                    where t.repay_start_date <![CDATA[>=]]> #yearStartDate#
	                      and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id, t.annual_rate * t.amount) a)
	          union all
	          (select 'H5042' "指标编码",
	                  '当年个体直接借贷发生额的加权平均期限(月)' "指标名称",
	                  '月度' "频度",
	                  nvl(avg(a.time_limit), 0) "金额(数量)",
	                  '指用当年个体直接借贷业务发生金额为权重加权计算的平均借款期限' "填报说明"
	             from (select t.borrower_user_info_id,
	                          (t.time_limit * t.amount / sum(t.amount)) time_limit
	                     from PRODUCT t
	                    where t.repay_start_date <![CDATA[>=]]> #yearStartDate#
	                      and t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id, t.time_limit * t.amount) a)
	          union all (select 'H5043' "指标编码",
	                        '个体直接借贷累计借款金额(首次报数用)(万元)' "指标名称",
	                        '月度' "频度",
	                        nvl(sum(t.amount), 0) / 10000 "金额(数量)",
	                        '指平台上线至首次报数期期末，借款人在平台上以个体直接借贷方式累计成功借款的金额。该指标首次报数时填报数据，以后各期无需填报数据' "填报说明"
	                   from PRODUCT t
	                  where t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	                    and t.status not in ('init', 'fail')
	                    and t.data_status = 'valid') union all
	          (select 'H5044' "指标编码",
	                  '个体直接借贷累计借款笔数(首次报数用)(笔)' "指标名称",
	                  '月度' "频度",
	                  count(*) "金额(数量)",
	                  '指平台上线至首次报数期期末，借款人在平台上以个体直接借贷方式累计成功借款的借款笔数。该指标首次报数时填报数据，以后各期无需填报数据' "填报说明"
	             from PRODUCT t
	            where t.repay_start_date <![CDATA[<=]]> #monthEndDate#
	              and t.status not in ('init', 'fail')
	              and t.data_status = 'valid') union all
	          (select 'H5045' "指标编码",
	                  '期末个体直接借贷借款余额(万元)' "指标名称",
	                  '月度' "频度",
	                  nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	                  '指截至报数期期末，平台上个体直接借贷的借款余额' "填报说明"
	             from TENDER_REPAYMENT t
	            where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	              and t.status = 'unRepay'
	              and t.data_status = 'valid') union all
	          (select 'H5046' "指标编码",
	                  '其中：最大单户借款余额(万元)' "指标名称",
	                  '月度' "频度",
	                  最大单户借款余额 "金额(数量)",
	                  '指个体直接借贷中，最大单个借款人的借款余额' "填报说明" from(
	                   select t.borrower_user_info_id,
	                          sum(t.repay_amount + t.fee) / 10000 最大单户借款余额
	                     from TENDER_REPAYMENT t
	                    where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	                      and t.status = 'unRepay'
	                      and t.data_status = 'valid'
	                    group by t.borrower_user_info_id
	                    order by sum(t.repay_amount + t.fee) desc
	           ) where rownum <![CDATA[<=]]> 1)
	  union all (select 'H5047' "指标编码",
	               '其中：最大十户借款余额(万元)' "指标名称",
	               '月度' "频度",
	               nvl(sum(最大十户借款余额), 0) "金额(数量)",
	               '指个体直接借贷中，借款最多的前十户借款人的借款余额' "填报说明" from(
	                select t.borrower_user_info_id,
	                       sum(t.repay_amount + t.fee) / 10000 最大十户借款余额
	                  from TENDER_REPAYMENT t
	                 where t.create_time <![CDATA[<=]]> #monthEndDate# || ' 23:59:59'
	                   and t.status = 'unRepay'
	                   and t.data_status = 'valid'
	                 group by t.borrower_user_info_id
	                 order by sum(t.repay_amount + t.fee) desc)
	   where rownum <![CDATA[<=]]> 10) union all
	 (select 'H6002' "指标编码",
	         '逾期债权类融资余额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_principal_amount), 0) / 10000 "金额(数量)",
	         '指合同约定到期(含展期后到期)未归还本金或利息的债权类融资本金余额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and (NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]> to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd'))
	     and t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union all
	 (select 'H6003' "指标编码",
	         '其中：个体直接借贷(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_principal_amount), 0) / 10000 "金额(数量)",
	         '指其中：个体直接借贷逾期债权类融资余额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and (NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]> to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd'))
	     and t.status = 'unRepay') union all
	 (select 'H6004' "指标编码",
	         '小额贷款公司网络小额贷款(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_principal_amount), 0) / 10000 "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款逾期债权类融资余额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and (NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]> to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd'))
	     and t.status = 'unRepay') union all
	 (select 'H6005' "指标编码",
	         '90天以上逾期债权类融资余额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(CASE
	                   WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                        to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                    t.repay_principal_amount
	                   else
	                    null
	                 end),
	             0) / 10000 "金额(数量)",
	         '指逾期 90 天(含)以上的债权类融资本金余额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	   and (NEXT_DAY(to_date(t.repay_plan_date, 'yyyy-mm-dd'), 5) <![CDATA[<]]> to_date(substr(#monthEndDate#, 1, 10), 'yyyy-mm-dd'))
	     and t.status = 'unRepay') union all
	 (select 'H6006' "指标编码",
	         '其中：个体直接借贷(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(CASE
	                   WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                        to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                    t.repay_principal_amount
	                   else
	                    null
	                 end),
	             0) / 10000 "金额(数量)",
	         '指其中：个体直接借贷逾期 90 天(含)以上的债权类融资本金余额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6007' "指标编码",
	         '小额贷款公司网络小额贷款(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(CASE
	                   WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                        to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                    t.repay_principal_amount
	                   else
	                    null
	                 end),
	             0) / 10000 "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款逾期 90 天(含)以上的债权类融资本金余额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay')
	
	union all
	 (select 'H6008' "指标编码",
	         '逾期债权类融资笔数(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指合同约定到期(含展期后到期)未归还本金或利息的债权类融资的笔数' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union all
	 (select 'H6009' "指标编码",
	         '其中：个体直接借贷(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指其中：个体直接借贷逾期债权的笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.user_info_id != '14082511240267427903'
	     and t.status = 'unRepay') union all
	 (select 'H6010' "指标编码",
	         '小额贷款公司网络小额贷款(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款逾期债权的笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6011' "指标编码",
	         '90天以上逾期债权类融资笔数(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                  t.product_id
	                 else
	                  null
	               end) "金额(数量)",
	         '指逾期 90 天(含)以上的债权类融资笔数' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6012' "指标编码",
	         '其中：个体直接借贷(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                  t.product_id
	                 else
	                  null
	               end) "金额(数量)",
	         '指其中：个体直接借贷逾期 90 天(含)以上的债权类融资笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6013' "指标编码",
	         '小额贷款公司网络小额贷款(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct CASE
	                 WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                      to_date(t.repay_plan_date, 'yyyy-mm-dd')-5) BETWEEN 91 and 999 then
	                  t.product_id
	                 else
	                  null
	               end) "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款逾期 90 天(含)以上的债权类融资笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6014' "指标编码",
	         '提前还款金额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指报告期内融资方因提前还款，终止合同的债权类融资金额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6015' "指标编码",
	         '其中：个体直接借贷(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指其中：个体直接借贷提前还款金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6016' "指标编码",
	         '小额贷款公司网络小额贷款(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款提前还款金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6017' "指标编码",
	         '提前还款笔数(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指报告期内融资方因提前还款，终止合同的债权类融资笔数' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6018' "指标编码",
	         '其中：个体直接借贷(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指其中：个体直接借贷提前还款笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6019' "指标编码",
	         '小额贷款公司网络小额贷款(笔)' "指标名称",
	         '月度' "频度",
	         count(distinct t.product_id) "金额(数量)",
	         '指其中：小额贷款公司网络小额贷款提前还款笔数' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('corp')
	     and t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_type = 'prepay'
	     and t.data_status = 'valid') union all
	 (select 'H6020' "指标编码",
	         '当期代偿金额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指报告期时段内因融资方违约等原因代为偿还的资金金额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_user_type != 'borrower'
	     and t.data_status = 'valid') union all
	 (select 'H6021' "指标编码",
	         '其中：个体直接借贷(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指其中：个体直接借贷当期代偿金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[>=]]> #monthStartDate#
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.status = 'repayed'
	     and t.repay_user_type != 'borrower'
	     and t.data_status = 'valid') union all
	 (select 'H6022' "指标编码",
	         '当年累计代偿金额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指年初至报告期时段因融资方违约等原因代为偿还的资金金额' "填报说明"
	    from TENDER_REPAYMENT t
	   where t.repay_time <![CDATA[>=]]> #yearStartDate#||' 00:00:00'
	     and t.repay_time <![CDATA[<=]]> #monthEndDate#||' 23:59:59'
	     and t.status = 'repayed'
	     and t.repay_user_type != 'borrower'
	     and t.data_status = 'valid') union all
	 (select 'H6023' "指标编码",
	         '其中：个体直接借贷(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(t.repay_amount + t.fee), 0) / 10000 "金额(数量)",
	         '指其中：个体直接借贷当年累计代偿金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_time <![CDATA[>=]]> #yearStartDate#||' 00:00:00'
	     and t.repay_time <![CDATA[<=]]> #monthEndDate#||' 23:59:59'
	     and t.status = 'repayed'
	     and t.repay_user_type != 'borrower'
	     and t.data_status = 'valid') union all
	 (select 'H6024' "指标编码",
	         '个体直接借贷出借人当期损失本金金额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(CASE
	                   WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                        to_date(t.repay_plan_date, 'yyyy-mm-dd')) BETWEEN 999 and 9999 then
	                    t.repay_principal_amount
	                   else
	                    null
	                 end),
	             0) / 10000 "金额(数量)",
	         '指出借人在报告期时段内确认因出借资金损失的本金金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay') union all
	 (select 'H6025' "指标编码",
	         '个体直接借贷出借人当年累计损失本金金额(万元)' "指标名称",
	         '月度' "频度",
	         nvl(sum(CASE
	                   WHEN (to_date(#monthEndDate#, 'yyyy-mm-dd') -
	                        to_date(t.repay_plan_date, 'yyyy-mm-dd')) BETWEEN 999 and 9999 then
	                    t.repay_principal_amount
	                   else
	                    null
	                 end),
	             0) / 10000 "金额(数量)",
	         '指出借人在年初至报告期时段内确认因出借资金损失的本金金额' "填报说明"
	    from TENDER_REPAYMENT t, borrower b
	   where t.borrower_user_info_id = b.user_info_id
	     and b.type in ('person', 'consultant')
	     and t.repay_plan_date <![CDATA[<=]]> #monthEndDate#
	     and t.data_status = 'valid'
	     and t.status = 'unRepay')) ta)
	         
	select taball."indexCode",
	       taball."indexName",
	       taball."frequency",
	       taball."amount",
	       taball."desc"
	  from taball
	  
  </sql>

    <select id="selectenterpriseData" resultClass="hashMap" parameterClass="map">
        select * from ( select rowtemp.*, rownum rownumtemp from (
        <include refid="enterpriseDataSubmit_fragment"/>
        ) rowtemp )
        where rownumtemp <![CDATA[<=]]> #rowEnd#
        and rownumtemp  <![CDATA[>]]> #rowStart#
    </select>

    <select id="selectenterpriseDataTotalCount" resultClass="int" parameterClass="map">
        select count (*) as total from (
        <include refid="enterpriseDataSubmit_fragment"/>
        )
    </select>
</sqlMap>
